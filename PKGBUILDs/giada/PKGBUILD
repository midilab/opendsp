# Maintainer: Romulo Silva <contact@midilab.co>
_pkgbasename=giada
pkgname=${_pkgbasename}-git
pkgver=r2
commit=64bcf9429db0aff00f7067c65f138ffb2f9d37e1
pkgrel=1
pkgdesc="A free, minimal, hardcore audio tool for DJs, live performers and electronic musicians"
arch=('armv7h')
url="https://www.giadamusic.com/"
license=('GPL3')
groups=('pro-audio')
depends=('fltk' 'jansson' 'libpulse' 'libxpm' 'rtmidi')
makedepends=('gendesk' 'imagemagick')
provides=("${_pkgbasename}")
conflicts=("${_pkgbasename}")
source=("${_pkgbasename}::git+https://github.com/monocasual/giada.git")
#source=("${_pkgbasename}::git+https://github.com/monocasual/giada.git#commit=${commit}")
sha256sums=('SKIP')

pkgver() {
  cd "${srcdir}/${_pkgbasename}"

  printf "r%s.%s" "$(git rev-list --count HEAD)" "$(git rev-parse --short HEAD)"
}

prepare() {
  cd "${srcdir}/${_pkgbasename}"
  git submodule update --init --recursive
}

build() {
  cd "${srcdir}/${_pkgbasename}"
  cmake -B build/ -S . -DWITH_PULSE=OFF -DWITH_ALSA=OFF
}

package() {
  cd "${srcdir}/${_pkgbasename}"
  make DESTDIR="$pkgdir/" install
  # XDG integration
  install -vDm 644 "${pkgname}.desktop" -t "${pkgdir}/usr/share/applications"
  install -vDm 644 "extras/${pkgname}-logo.png" \
    "${pkgdir}/usr/share/pixmaps/${pkgname}.png"
  # docs
  install -vDm 644 {ChangeLog,README.md} \
    -t "${pkgdir}/usr/share/doc/${pkgname}"
}