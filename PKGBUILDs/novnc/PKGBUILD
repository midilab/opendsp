# Maintainer: Radek Podgorny <radek@podgorny.cz>
pkgname=novnc
pkgver=1.4.0
pkgrel=1
pkgdesc="javascript vnc client"
arch=(any)
url="https://github.com/kanaka/noVNC"
license=('GPL')
depends=('bash' 'python' 'net-tools')
source=("https://github.com/kanaka/noVNC/archive/v${pkgver}.tar.gz")
md5sums=('7a81bbc7a33f4378b0a9bb1b89954b49')

prepare() {
  cd $srcdir/noVNC-${pkgver}
  #rm -f utils/*.o
  rm -rf .git
}

build() {
  cd $srcdir/noVNC-${pkgver}
}

package() {
  cd $srcdir/noVNC-${pkgver}
  cp -Rf ../../websockify/ utils/
  chmod 774 utils/websockify/run
  chmod 774 utils/websockify/rebind 
  mkdir -p $pkgdir/usr/share/novnc $pkgdir/usr/share/doc/novnc $pkgdir/usr/bin
  mv vnc_lite.html index.html
  cp -a app core vendor utils vnc.html index.html $pkgdir/usr/share/novnc/
  cp -a LICENSE.txt README.md $pkgdir/usr/share/doc/novnc
  cat >$pkgdir/usr/bin/novnc <<EOF

cd /usr/share/novnc || exit 1
exec ./utils/novnc_proxy --vnc localhost:5900 --listen 80 \$*
EOF
  chmod 0755 $pkgdir/usr/bin/novnc
}

