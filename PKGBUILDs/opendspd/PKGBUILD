# Maintainer: Midilab <contact@midilab.co>

pkgname=opendspd
pkgver=36.49fe703
pkgrel=1
pkgdesc='OpenDSP Service'
arch=(any)
url='http://midilab.co/opendspd'
license=('GPL')
depends=(sudo xorg-server xorg-xinit xorg-server-common xterm openbox x11vnc alsa-firmware alsa-lib alsa-plugins alsa-utils python-setuptools python-pip liblo python-pyliblo cython python-decorator python-appdirs python-certifi python-packaging python-pillow python-psutil python-pyparsing python-pyserial python-six python-tornado python-virtualenv python-jack-client jack mididings-git xdotool ingen-git mda.lv2 calf ecasound rtirq cpupower)
install="$pkgname.install"
source=("git+https://github.com/midilab/opendspd.git")
md5sums=('SKIP')

pkgver()
{
  cd "$pkgname"
  echo $(git rev-list --count HEAD).$(git rev-parse --short HEAD)
  #echo $(git describe --long | sed 's/\([^-]*-g\)/r\1/;s/-/./g')
}

prepare() 
{
  cd "${srcdir}/${pkgname}"
}

build() 
{
  cd "${srcdir}/${pkgname}"
}

package()
{
  cd "${srcdir}/${pkgname}"
  python setup.py install --root="$pkgdir"
  install -vD ../../opendsp-service   -m 0755 $pkgdir/usr/bin/opendspd
  install -vD ../../systemd/opendsp.service -m 0644 $pkgdir/etc/systemd/system/opendsp.service
  install -vD ../../systemd/x11vnc.service  -m 0644 $pkgdir/etc/systemd/system/x11vnc.service
  install -vD ../../systemd/startx.service  -m 0644 $pkgdir/etc/systemd/system/startx.service
  install -vd -m 0755 $pkgdir/home/opendsp/data/
  cp -Rf ../../app-data/* $pkgdir/home/opendsp/data/
}
